var j=Object.defineProperty,ve=Object.defineProperties,xe=Object.getOwnPropertyDescriptor,we=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var oe=(o,e,t)=>e in o?j(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,a=(o,e)=>{for(var t in e||(e={}))M.call(e,t)&&oe(o,t,e[t]);if(U)for(var t of U(e))re.call(e,t)&&oe(o,t,e[t]);return o},R=(o,e)=>ve(o,we(e)),Oe=o=>j(o,"__esModule",{value:!0});var T=(o,e)=>{var t={};for(var n in o)M.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&U)for(var n of U(o))e.indexOf(n)<0&&re.call(o,n)&&(t[n]=o[n]);return t};var Ae=(o,e)=>{for(var t in e)j(o,t,{get:e[t],enumerable:!0})},Pe=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ee(e))!M.call(o,r)&&(t||r!=="default")&&j(o,r,{get:()=>e[r],enumerable:!(n=xe(e,r))||n.enumerable});return o};var _e=(o=>(e,t)=>o&&o.get(e)||(t=Pe(Oe({}),e,1),o&&o.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var W=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var b=(o,e,t)=>(W(o,e,"read from private field"),t?t.call(o):e.get(o)),h=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)},w=(o,e,t,n)=>(W(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);var S=(o,e,t)=>(W(o,e,"access private method"),t);var m=(o,e,t)=>new Promise((n,r)=>{var s=c=>{try{i(t.next(c))}catch(l){r(l)}},g=c=>{try{i(t.throw(c))}catch(l){r(l)}},i=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,g);i((t=t.apply(o,e)).next())});var Ve={};Ae(Ve,{Evented:()=>_,LngLat:()=>u,LngLatBounds:()=>p,MapboxAutofill:()=>C,MapboxError:()=>N,MapboxGeocode:()=>Z,MapboxSearch:()=>I,MapboxValidate:()=>D,MatchCodeConfidence:()=>ee,SearchSession:()=>ne,SessionToken:()=>f,debounce:()=>B,featureToSuggestion:()=>Te,polyfillFetch:()=>he});var E="https://api.mapbox.com/search/v1",K="suggest",z="retrieve",se="forward",ie="reverse",ae=`${E}/${K}`,ge=`${E}/${z}`,ce=`${E}/${se}`,ue=`${E}/permanent/${se}`,le=`${E}/${ie}`,me=`${E}/permanent/${ie}`;var u=class{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(e){if(e instanceof u)return new u(e.lng,e.lat);if(Array.isArray(e)&&e.length===2)return new u(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null&&("lng"in e||"lon"in e)&&"lat"in e)return new u(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};var p=class{constructor(e,t){this._sw=u.convert(e),this._ne=u.convert(t)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u(this.getWest(),this.getNorth())}getSouthEast(){return new u(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(e){if(!e)throw new Error("Invalid LngLatBounds convert value: falsy");if(e instanceof p)return new p(e.getSouthWest(),e.getNorthEast());if(Array.isArray(e)&&e.length===2)return new p(u.convert(e[0]),u.convert(e[1]));if(Array.isArray(e)&&e.length===4)return new p(u.convert([e[0],e[1]]),u.convert([e[2],e[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};function pe(){let e=(Math.random().toString(16)+Date.now().toString(16)+Math.random().toString(16)).replace(/\./g,"");return[e.slice(0,8),e.slice(8,12),"4"+e.slice(12,15)+"-8"+e.slice(15,18),e.slice(18,30)].join("-")}var f=class{constructor(e){this.id=e!=null?e:pe()}toString(){return this.id}static convert(e){return new f(e instanceof f?e.id:e.toString())}};var Fe="Unknown error",N=class extends Error{constructor(e,t){super(String(e.message||e.error||Fe));this.name="MapboxError",this.statusCode=t}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function L(o){return m(this,null,function*(){if(!o.ok){let e=yield o.json();throw new N(e,o.status)}})}var $=globalThis.fetch,fe=globalThis.AbortController;function he({fetch:o,AbortController:e},t=!1){if(!o)throw new Error("Fetch implementation must include implementations of `fetch`.");$&&!t||($=o,fe=e)}function d(){if(!$)throw new Error("Fetch implementation not found. Please include a fetch polyfill in your application or use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:$,AbortController:fe}}function y(...o){let e=[];for(let t of o){if(!t)continue;let n=Object.entries(t);for(let[r,s]of n)s!=null&&e.push(`${r}=${encodeURIComponent(String(s))}`)}return e.join("&")}var A,de,G,Ue,H=class{constructor(e={}){h(this,A);h(this,G);let r=e,{accessToken:t}=r,n=T(r,["accessToken"]);this.accessToken=t,this.defaults=a(a({},H.defaults),n)}suggest(e,t){return m(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:n,signal:r}=t,s=R(a(a({},this.defaults),t),{sessionToken:n});if(s.eta_type&&(!s.origin||!s.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(s.origin&&!s.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");let g=new URL(`${ae}/${encodeURIComponent(e)}`);g.search=S(this,A,de).call(this,s);let{fetch:i}=d(),c=yield i(g.toString(),{signal:r});return yield L(c),yield c.json()})}retrieve(e,t){return m(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.canRetrieve(e))throw new Error("suggestion cannot be retrieved");let{sessionToken:n,signal:r}=t,s=f.convert(n),g=new URL(ge);g.search=y({access_token:this.accessToken,session_token:s.id});let{fetch:i}=d(),c=yield i(g.toString(),R(a({},S(this,G,Ue).call(this,e)),{signal:r}));return yield L(c),yield c.json()})}canRetrieve(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===z:!1}canSuggest(e){let t=e.action;return t?t.method==="POST"&&t.endpoint===K:!1}forward(n){return m(this,arguments,function*(e,t={}){if(!e)throw new Error("searchText is required");let r=a(a({},this.defaults),t),s=r.permanent?ue:ce,g=new URL(`${s}/${encodeURIComponent(e)}`);g.search=S(this,A,de).call(this,r);let{fetch:i}=d(),c=yield i(g.toString(),{signal:r.signal});return yield L(c),yield c.json()})}reverse(n){return m(this,arguments,function*(e,t={}){if(!e)throw new Error("lngLat is required");let r=a(a({},this.defaults),t),s=typeof e=="string"?e:u.convert(e).toArray().join(","),g=r.permanent?me:le,i=new URL(`${g}/${encodeURIComponent(s)}`);i.search=y({access_token:this.accessToken,language:r.language,limit:r.limit},r.types&&{types:typeof r.types=="string"?r.types:[...r.types].join(",")});let{fetch:c}=d(),l=yield c(i.toString(),{signal:r.signal});return yield L(l),yield l.json()})}},I=H;A=new WeakSet,de=function(e){return y({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit,navigation_profile:e.navigation_profile,eta_type:e.eta_type},e.sessionToken&&{session_token:f.convert(e.sessionToken).id},e.origin&&{origin:typeof e.origin=="string"?e.origin:u.convert(e.origin).toArray().join(",")},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:p.convert(e.bbox).toFlatArray().join(",")},e.types&&{types:typeof e.types=="string"?e.types:[...e.types].join(",")})},G=new WeakSet,Ue=function(e){if(!this.canRetrieve(e)&&!this.canSuggest(e))throw new Error("Suggestion cannot be retrieved or suggested");let t=e.action,n=JSON.stringify(t.body);return{method:t.method,body:n,headers:{"Content-Type":"application/json","Content-Length":n.length.toString()}}},I.defaults={language:"en"};var Le="https://api.mapbox.com/autofill/v1",je="suggest",Ne="retrieve",be=`${Le}/${je}`,Re=`${Le}/${Ne}`;var V,$e,Q=class{constructor(e={}){h(this,V);let r=e,{accessToken:t}=r,n=T(r,["accessToken"]);this.accessToken=t,this.defaults=a(a({},Q.defaults),n)}suggest(e,t){return m(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:n,signal:r}=t,s=R(a(a({},this.defaults),t),{sessionToken:n}),g=new URL(`${be}/${encodeURIComponent(e)}`);g.search=S(this,V,$e).call(this,s);let{fetch:i}=d(),c=yield i(g.toString(),{signal:r});yield L(c);let l=yield c.json();return R(a({},l),{suggestions:l.suggestions.map(x=>R(a({},x),{original_search_text:e}))})})}retrieve(e,t){return m(this,null,function*(){if(!e)throw new Error("suggestion is required");if(!this.canRetrieve(e))throw new Error("suggestion cannot be retrieved");let{sessionToken:n,signal:r}=t,s=f.convert(n),g=new URL(`${Re}/${e.action.id}`);g.search=y({access_token:this.accessToken,session_token:s.id});let{fetch:i}=d(),c=yield i(g.toString(),{signal:r});return yield L(c),yield c.json()})}canRetrieve(e){let t=e.action;return typeof(t==null?void 0:t.id)=="string"}},C=Q;V=new WeakSet,$e=function(e){return y({types:"address",streets:!0,access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit},e.sessionToken&&{session_token:f.convert(e.sessionToken).id},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:p.convert(e.bbox).toFlatArray().join(",")})},C.defaults={language:"en",proximity:"ip"};var Ie="https://api.mapbox.com/autofill/v1",Ge="retrieve",Se=`${Ie}/${Ge}`;var q,Ce,J=class{constructor(e={}){h(this,q);let r=e,{accessToken:t}=r,n=T(r,["accessToken"]);this.accessToken=t,this.defaults=a(a({},J.defaults),n)}validate(e,t){return m(this,null,function*(){if(!e)throw new Error("searchText is required");let{sessionToken:n,signal:r}=t,s=R(a(a({},this.defaults),t),{sessionToken:n}),g=new URL(`${Se}/${encodeURIComponent(e)}`);g.search=S(this,q,Ce).call(this,s);let{fetch:i}=d(),c=yield i(g.toString(),{signal:r});yield L(c);let l=yield c.json();return l.features.length>0&&(l.features=[l.features[0]]),l})}},D=J;q=new WeakSet,Ce=function(e){return y({access_token:this.accessToken,language:e.language,country:e.country},e.sessionToken&&{session_token:f.convert(e.sessionToken).id},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:p.convert(e.bbox).toFlatArray().join(",")})},D.defaults={language:"en",proximity:"ip"};var ye="https://api.mapbox.com/geocoding/v5",X=`${ye}/mapbox.places`,Y=`${ye}/mapbox.places-permanent`;var P,ke,Z=class{constructor(e={}){h(this,P);let r=e,{accessToken:t}=r,n=T(r,["accessToken"]);this.accessToken=t,this.defaults=a({},n)}forward(e,t){return m(this,null,function*(){if(!e)throw new Error("searchText is required");let n;t&&({signal:n}=t);let r=a(a({},this.defaults),t),s=r.permanent?Y:X,g=new URL(`${s}/${encodeURIComponent(e)}.json`);g.search=S(this,P,ke).call(this,r);let{fetch:i}=d(),c=n?{signal:n}:{},l=yield i(g.toString(),c);return yield L(l),yield l.json()})}reverse(e,t){return m(this,null,function*(){if(!e)throw new Error("lngLat is required");let n;t&&({signal:n}=t);let r=a(a({},this.defaults),t),s=typeof e=="string"?e:u.convert(e).toArray().join(","),g=r.permanent?Y:X,i=new URL(`${g}/${encodeURIComponent(s)}.json`);i.search=S(this,P,ke).call(this,r,!0);let{fetch:c}=d(),l=n?{signal:n}:{},x=yield c(i.toString(),l);return yield L(x),yield x.json()})}};P=new WeakSet,ke=function(e,t=!1){return t&&["proximity","autocomplete","fuzzyMatch","bbox"].forEach(n=>{n in e&&delete e[n]}),y({access_token:this.accessToken,language:e.language,country:e.country,limit:e.limit,autocomplete:e.autocomplete,fuzzyMatch:e.fuzzyMatch,routing:e.routing,worldview:e.worldview},e.proximity&&{proximity:typeof e.proximity=="string"?e.proximity:u.convert(e.proximity).toArray().join(",")},e.bbox&&{bbox:typeof e.bbox=="string"?e.bbox:p.convert(e.bbox).toFlatArray().join(",")},e.types&&{types:typeof e.types=="string"?e.types:[...e.types].join(",")})};var ee=(r=>(r.exact="exact",r.high="high",r.medium="medium",r.low="low",r))(ee||{});var O,_=class{constructor(){h(this,O,{})}addEventListener(e,t){let n=b(this,O);n[e]||(n[e]=[]),n[e].push(t)}removeEventListener(e,t){let n=b(this,O);if(!n[e])return;let r=n[e],s=r.indexOf(t);s!==-1&&r.splice(s,1)}fire(e,t){let n=b(this,O);if(!n[e])return;let r=n[e];for(let s of r)s(t)}};O=new WeakMap;function B(o,e,t){let n=null;return(...r)=>{n!==null&&clearTimeout(n);let s=t&&t();n=setTimeout(()=>{n=null,!(s==null?void 0:s.aborted)&&o(...r)},e)}}function te(){let{AbortController:o}=d();return new o}var v,k,F,ne=class extends _{constructor(e,t=0){super();this.sessionToken=new f;h(this,v,void 0);h(this,k,te());h(this,F,void 0);w(this,F,B((s,...g)=>m(this,[s,...g],function*(n,r={}){if(b(this,k).abort(),w(this,k,te()),!n){w(this,v,null),this.fire("suggest",b(this,v));return}try{let i=yield this.search.suggest(n,R(a({sessionToken:this.sessionToken},r),{signal:b(this,k).signal}));w(this,v,i),this.fire("suggest",i)}catch(i){if(i.name==="AbortError")return;this.fire("suggesterror",i)}}),t,()=>b(this,k).signal)),Object.defineProperties(this,{search:{value:e,writable:!1},debounce:{value:t,writable:!1}})}get suggestions(){return b(this,v)}suggest(e,t){return b(this,F).call(this,e,t),new Promise((n,r)=>{let s,g;s=i=>{this.removeEventListener("suggest",s),this.removeEventListener("suggesterror",g),n(i)},g=i=>{this.removeEventListener("suggest",s),this.removeEventListener("suggesterror",g),r(i)},this.addEventListener("suggest",s),this.addEventListener("suggesterror",g)})}clear(){this.suggest("")}retrieve(e,t){return m(this,null,function*(){let n=yield this.search.retrieve(e,a({sessionToken:this.sessionToken},t));return this.fire("retrieve",n),n})}canRetrieve(e){return this.search.canRetrieve?this.search.canRetrieve(e):!0}canSuggest(e){return this.search.canSuggest?this.search.canSuggest(e):!0}abort(){b(this,k).abort(),w(this,k,te())}};v=new WeakMap,k=new WeakMap,F=new WeakMap;function Te(o){let{properties:e}=o;return a({},e)}module.exports=_e(Ve);
//# sourceMappingURL=index.js.map
